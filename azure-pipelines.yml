variables:
  buildContainerImage: 'mcr.microsoft.com/dotnet/sdk:8.0'
  projectName: Texnomic.Blazor.hCaptcha
  buildConfiguration: 'Release'

trigger:
- master

pool:
  name: 'Builders'
  demands: 
    - docker

stages:
  - stage: Build
    displayName: Build Nuget package
    jobs:
      - job: Build
        container:
          image: $(buildContainerImage)
        steps:
        - task: CmdLine@2
          displayName: 'Publish'
          inputs:
            script: 'dotnet publish $(projectName) -c Release'
        - task: NuGetCommand@2
          displayName: 'Nuget pack'
          inputs:
            command: pack
            packagesToPack: '**/*.csproj'
            versioningScheme: byPrereleaseNumber
            versionEnvVar: 'BUILD_SOURCEBRANCHNAME'
            buildProperties: 'Configuration=Release'
        - task: NuGetCommand@2
          displayName: 'NuGet push'
          inputs:
            command: push
            nuGetFeedType: external
            publishFeedCredentials: 'Nuget EilikoOy'

