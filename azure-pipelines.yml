variables:
  buildContainerImage: 'mcr.microsoft.com/dotnet/sdk:8.0'
  projectName: Eiliko.Blazor.hCaptcha
  buildConfiguration: 'Release'

trigger:
- master

pool:
  name: 'Builders'
  demands: 
    - docker

stages:
  - stage: Build
    displayName: Build Nuget package
    jobs:
      - job: Build
        container:
          image: $(buildContainerImage)
        steps:
        - task: CmdLine@2
          displayName: 'Publish'
          inputs:
            script: 'dotnet publish $(projectName) -c Release'
        - task: CmdLine@2
          displayName: 'Pack'
          inputs:
            script: 'dotnet pack $(projectName).sln -c $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)'
        - task: CmdLine@2
          displayName: 'Publish Artifact'
          inputs:
            script: 'dotnet nuget push $(Build.ArtifactStagingDirectory)/*.nupkg --source https://api.nuget.org/v3/index.json --api-key $(NugetApiKey)'

